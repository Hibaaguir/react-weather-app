pipeline {
    agent any
    stages {
        stage('Checkout') {
            steps {
                checkout scm
            }
        }
        
        stage('Audit Dependencies') {
            steps {
                script {
                    // Analyser le code pour trouver les imports manquants
                    sh '''
                        echo "=== ANALYSE DES DÉPENDANCES MANQUANTES ==="
                        grep -r "import.*from" src/ | grep -o "from ['\\\"][^'\\\"]*['\\\"]" | cut -d "'" -f 2 | cut -d "\\"" -f 2 | sort | uniq > imports.txt
                        echo "Imports détectés :"
                        cat imports.txt || echo "Aucun import détecté"
                        
                        echo "=== COMPARAISON AVEC PACKAGE.JSON ==="
                        npm list --depth=0 > installed.txt 2>&1 || true
                        
                        # Vérifier les dépendances manquantes
                        echo "Dépendances installées :"
                        cat package.json | grep -o '"dependencies": {[^}]*}' || echo "Aucune dépendance dans package.json"
                    '''
                }
            }
        }
        
        stage('Setup Complete') {
            steps {
                script {
                    // Installation de toutes les dépendances manquantes communes
                    sh '''
                        echo "=== INSTALLATION DES DÉPENDANCES MANQUANTES ==="
                        npm install react-i18next --legacy-peer-deps || echo "react-i18next installation échouée"
                        npm install gsap --legacy-peer-deps || echo "gsap installation échouée"
                        npm install axios --legacy-peer-deps || echo "axios installation échouée"
                        
                        # Réinstallation complète pour être sûr
                        npm install --legacy-peer-deps
                    '''
                }
            }
        }
        
        stage('Build') {
    steps {
        script {
            echo "=== BUILD DE L'APPLICATION ==="
            bat 'set CI=false && npm run build'
            echo "✅ Build réussi !"
        }
    }
}
        
        // ... les autres stages restent les mêmes
    }
}